<!--
Copyright 2013 The Polymer Authors. All rights reserved.
Use of this source code is governed by a BSD-style
license that can be found in the LICENSE file.
-->
<link rel="import" href="../polymer/polymer.html">
<link rel="import" href="chartjs-import.html">

<!--
 Chartjs Pie Element

 Easy, object oriented client side graphs for designers and developers.

 http://www.chartjs.org

 @class chart-js
 @origin-url http://www.chartjs.org/
 @categories Charts and Graphs
 @license Three-clause BSD
-->

<dom-module name="chart-doughnut">

  <style>
    :host {
      display: inline-block;
      width: 300px;
      height: 260px;
    }
  </style>

  <template>

    <canvas id="chart" width="{{width}}" height="{{height}}"></canvas>

  </template>

  <script>

    Polymer({

      is: 'chart-doughnut',

      properties: {

        data: {
          type: Array,
          value: function() {
            return [];
          }
        },

        options: {
          type: Object,
          value: null
        },

        chart: {
          type: Object,
          observer: '_chartChanged',
          computed: '_computeChart(options, ctx, data)'
        }

      },

      attached: function() {
        // TODO(sjmiles): measuring not available synchronously at attached (on Chrome)
        // TODO(sjmiles): size of canvas not settable synchronously at attached (on Chrome)
        this.async(this._createContext, 1);
      },

      _createContext: function() {
        this.width = Math.max(this.offsetWidth, 200);
        this.height = Math.max(this.offsetHeight, 100);
        this.ctx = this.$.chart.getContext('2d');
      },

      _computeChart: function(options, ctx, data) {
        return new Chart(ctx).Doughnut(data, options);
      },

      _chartChanged: function(chart, old) {
        if (old) {
          old.destroy();
        }
      }

    });
  </script>

</dom-module>
